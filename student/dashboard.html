<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>NexAttend | Student Dashboard</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700;800&family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="../css/styles.css" />

  <!-- ‚úÖ Key Bridge: ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå session ‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠ -->
  <script>
    (function(){
      const a = localStorage.getItem("cpvc_student");
      const b = localStorage.getItem("studentSession");
      if(a && !b) localStorage.setItem("studentSession", a);
      if(b && !a) localStorage.setItem("cpvc_student", b);
    })();
  </script>

  <!-- ‚úÖ JS ‡∏´‡∏ô‡πâ‡∏≤ dashboard -->
  <script type="module" src="dashboard.js" defer></script>

  <style>
    :root{
      --bg:#f8fafc;
      --card: rgba(255,255,255,.72);
      --card2: rgba(255,255,255,.96);
      --text:#0f172a;
      --muted:#64748b;
      --border: rgba(226,232,240,.95);

      --blue:#38bdf8;
      --violet:#8b5cf6;

      --ok:#22c55e;
      --late:#f59e0b;
      --absent:#ef4444;

      --shadow: 0 18px 55px rgba(2,6,23,.10);
      --shadow2: 0 26px 70px rgba(2,6,23,.14);
      --r: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    html{ overflow-x:hidden; }

    body{
      margin:0;
      min-height:100vh;
      font-family:"Kanit","Inter",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 560px at 12% 14%, rgba(56,189,248,.16), transparent 62%),
        radial-gradient(900px 560px at 88% 16%, rgba(139,92,246,.14), transparent 62%),
        radial-gradient(900px 560px at 50% 92%, rgba(34,197,94,.10), transparent 62%),
        linear-gradient(180deg,#fff,var(--bg));
      overflow-x:hidden; /* ‡∏Å‡∏±‡∏ô‡∏•‡πâ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
      -webkit-text-size-adjust: 100%;
    }

    /* ===== Scrollbar ===== */
    html{ overflow-y: auto; scrollbar-gutter: stable; }
    ::-webkit-scrollbar{ width: 14px; }
    ::-webkit-scrollbar-track{
      background: rgba(2,6,23,.06);
      border-left: 1px solid rgba(226,232,240,.9);
    }
    ::-webkit-scrollbar-thumb{
      background: linear-gradient(180deg, rgba(56,189,248,.90), rgba(139,92,246,.80));
      border-radius: 999px;
      border: 3px solid rgba(255,255,255,.90);
    }
    ::-webkit-scrollbar-thumb:hover{
      background: linear-gradient(180deg, rgba(56,189,248,1), rgba(139,92,246,.95));
    }
    *{ scrollbar-width: auto; scrollbar-color: rgba(139,92,246,.80) rgba(2,6,23,.06); }

    /* ===== Topbar (‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏ö‡∏ô + Sticky) ===== */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 9999;
      width:100%;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      padding-top: env(safe-area-inset-top);
    }

    .topbar-inner{
      max-width:1100px;
      margin:0 auto;
      padding: 10px 18px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap; /* ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏Å‡∏±‡∏ô‡∏•‡πâ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 0;
      flex: 1 1 320px; /* ‚úÖ ‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡πÑ‡∏î‡πâ */
    }
    .logo{
      width:44px;height:44px;border-radius:16px;
      background: linear-gradient(135deg, var(--blue), var(--violet));
      box-shadow: 0 14px 30px rgba(2,6,23,.10);
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#04121f;
      font-size: 1.35rem;
      font-weight: 1000;
      user-select:none;
    }
    .btext{
      min-width:0;
      line-height:1.05;
    }
    .btitle{
      font-weight:1000;
      letter-spacing:-.2px;
      font-size:1.02rem;
      display:flex;
      gap:10px;
      align-items:center;
      min-width:0;
      flex-wrap: wrap; /* ‚úÖ ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
    }
    .bsub{
      margin-top:6px;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: .86rem;
      font-weight:900;
    }
    .tag{
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(2,6,23,.03);
      color: rgba(15,23,42,.82);
      font-weight:1000;
      font-size: .78rem;
      white-space:nowrap;
      box-shadow: 0 10px 22px rgba(2,6,23,.05);
      max-width: 100%;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:flex-end;
      flex: 0 1 auto;
      z-index: 2;
    }

    .btn{
      border:none;
      cursor:pointer;
      padding: 9px 13px;
      border-radius: 999px;
      font-weight:1000;
      font-size:.84rem;
      color:#04121f;
      background: linear-gradient(90deg, var(--blue), #60a5fa);
      box-shadow: 0 16px 40px rgba(56,189,248,.18);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      text-decoration:none;
      user-select:none;
      white-space:nowrap;
      transition:.18s;
      min-height: 40px;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 22px 58px rgba(56,189,248,.22); }

    .btn.secondary{
      background: rgba(255,255,255,.92);
      border: 1px solid var(--border);
      box-shadow: 0 10px 22px rgba(2,6,23,.06);
      color: var(--text);
    }
    .btn.secondary:hover{
      transform: translateY(-1px);
      border-color: rgba(148,163,184,.70);
      box-shadow: 0 16px 40px rgba(2,6,23,.10);
    }

    .btn.danger{
      background: linear-gradient(135deg, rgba(239,68,68,.95), rgba(245,158,11,.95));
      color:#fff;
      box-shadow: 0 16px 40px rgba(239,68,68,.18);
      border: none;
    }

    /* ===== Main ===== */
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 18px 64px;
    }

    #msg{
      margin: 8px 0 14px;
      font-size: .95rem;
      text-align:center;
      color: var(--muted);
      font-weight: 1000;
      min-height: 20px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
      margin-bottom: 14px;
    }

    .stat{
      border-radius: var(--r);
      background: var(--card2);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 16px 16px 14px;
      position:relative;
      overflow:hidden;
    }
    .stat::before{
      content:"";
      position:absolute; inset:-30% -30% auto auto;
      width:220px;height:220px;
      background: radial-gradient(circle at 30% 30%, rgba(56,189,248,.20), transparent 60%);
      transform: rotate(12deg);
      pointer-events:none;
    }
    .stat .label{
      font-size:.92rem;
      font-weight:1000;
      color: rgba(15,23,42,.72);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .stat .value{
      margin-top: 10px;
      font-size: 2.05rem;
      font-weight: 1100;
      letter-spacing:-.6px;
      font-variant-numeric: tabular-nums;
    }
    .stat .sub{
      margin-top: 6px;
      font-size:.86rem;
      font-weight:900;
      color: var(--muted);
    }

    .ok{ color: var(--ok); }
    .late{ color: var(--late); }
    .absent{ color: var(--absent); }

    .card{
      border-radius: var(--r);
      background: var(--card2);
      border: 1px solid var(--border);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }

    .card-head{
      padding: 16px 18px 12px;
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      border-bottom: 1px solid rgba(226,232,240,.85);
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .card-head h3{
      margin:0;
      font-size:1.05rem;
      font-weight:1000;
      letter-spacing:-.2px;
    }
    .hint{
      margin-top:6px;
      color: var(--muted);
      font-weight:900;
      font-size: .9rem;
    }

    .pill{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(148,163,184,.35);
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight:1000;
      background: rgba(2,6,23,.02);
      white-space:nowrap;
    }

    /* ‚úÖ Table responsive: ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    .table-wrap{
      padding: 0 18px 18px;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
    }
    table{
      width:100%;
      border-collapse: collapse;
      border-radius: 16px;
      overflow:hidden;
      border: 1px solid rgba(226,232,240,.95);
      background: rgba(255,255,255,.96);
      box-shadow: 0 12px 30px rgba(2,6,23,.06);
      min-width: 680px; /* ‚úÖ ‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ö‡∏µ‡∏¢‡∏î‡∏à‡∏ô‡∏û‡∏±‡∏á */
    }
    thead th{
      text-align:left;
      font-size:.82rem;
      color: rgba(100,116,139,.95);
      padding: 12px;
      background: rgba(2,6,23,.02);
      border-bottom: 1px solid rgba(226,232,240,.95);
      font-weight: 1000;
      letter-spacing:.7px;
      white-space:nowrap;
    }
    tbody td{
      padding: 12px;
      border-bottom: 1px solid rgba(226,232,240,.75);
      font-size: .92rem;
      color: var(--text);
      font-weight: 800;
      white-space:nowrap;
    }
    tbody tr:hover td{ background: rgba(56,189,248,.06); }
    tbody tr:last-child td{ border-bottom:none; }

    /* ===== Responsive ===== */
    @media (max-width: 980px){
      .grid{ grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px){
      .topbar-inner{ padding: 10px 14px; }
      .wrap{ padding: 14px 14px 56px; }
      .card-head{ padding: 14px 14px 10px; }
      .table-wrap{ padding: 0 14px 14px; }
      .bsub{ display:none; }

      /* ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏£‡∏¥‡∏î 2 ‡πÅ‡∏ñ‡∏ß ‡∏Å‡∏î‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö */
      .actions{
        width: 100%;
        justify-content:flex-start;
        display:grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
      }
      .btn{ width:100%; }

      /* ‚úÖ ID ‡∏¢‡∏≤‡∏ß ‡πÜ ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î */
      .btitle .tag{ max-width: 100%; }
    }

    @media (max-width: 520px){
      .grid{ grid-template-columns: 1fr; }
      .brand{ flex: 1 1 100%; }
      .btitle{ font-size: .98rem; }
      .logo{ width:42px; height:42px; font-size:1.28rem; }
    }
  </style>
</head>

<body>
  <!-- ‚úÖ Sticky Topbar -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">üéì</div>
        <div class="btext">
          <div class="btitle">
            STUDENT
            <span class="tag">üÜî <span id="studentIdDisplay">-</span></span>
          </div>
          <div class="bsub">
            <span id="studentNameDisplay">-</span>
            <span class="tag">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="lastUpdate">-</span></span>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn secondary" id="btnScan" type="button">üì∏ ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</button>
        <button class="btn secondary" id="btnHistory" type="button">üßæ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
        <button class="btn secondary" id="btnRefresh" type="button">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        <button class="btn danger" type="button" onclick="logoutStudent()">üö™ ‡∏≠‡∏≠‡∏Å</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="msg"></div>

    <!-- STATS -->
    <section class="grid" aria-label="stats">
      <div class="stat">
        <div class="label">üìö ‡∏Ñ‡∏≤‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div class="value" id="totalClasses">0</div>
        <div class="sub">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      </div>

      <div class="stat">
        <div class="label">‚úÖ ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
        <div class="value ok" id="presentCount">0</div>
        <div class="sub">STATUS = OK</div>
      </div>

      <div class="stat">
        <div class="label">‚è∞ ‡∏™‡∏≤‡∏¢</div>
        <div class="value late" id="lateCount">0</div>
        <div class="sub">STATUS = LATE</div>
      </div>

      <div class="stat">
        <div class="label">‚ùå ‡∏Ç‡∏≤‡∏î</div>
        <div class="value absent" id="absentCount">0</div>
        <div class="sub">STATUS = ABSENT</div>
      </div>
    </section>

    <!-- RECENT -->
    <section class="card">
      <div class="card-head">
        <div>
          <h3>üïò ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
          <div class="hint">‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏ß‡∏¥‡∏ä‡∏≤ / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / TOKEN</div>
        </div>
        <div class="hint">
          <span class="pill">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <span id="dashStatus">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span></span>
        </div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤</th>
              <th>üìö ‡∏ß‡∏¥‡∏ä‡∏≤</th>
              <th>‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th style="text-align:right;">üîë TOKEN</th>
            </tr>
          </thead>
          <tbody id="recentTbody">
            <tr><td colspan="4" style="text-align:center;opacity:.7;padding:14px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    function logoutStudent(){
      try{
        localStorage.removeItem("cpvc_student");
        localStorage.removeItem("studentSession");
        sessionStorage.clear();
      }catch(e){}
      location.href = "login.html";
    }
  </script>
</body>
</html>
