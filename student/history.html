<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NexAttend | ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700;800&family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="../css/styles.css" />

  <!-- ‚úÖ Key Bridge: ‡∏Å‡∏±‡∏ô‡∏Ñ‡∏µ‡∏¢‡πå session ‡∏Ñ‡∏ô‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠ -->
  <script>
    (function(){
      const a = localStorage.getItem("cpvc_student");
      const b = localStorage.getItem("studentSession");
      if(a && !b) localStorage.setItem("studentSession", a);
      if(b && !a) localStorage.setItem("cpvc_student", b);
    })();
  </script>

  <!-- ‚úÖ SheetJS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Export Excel (.xlsx) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
  <!-- ‚úÖ JS ‡∏´‡∏ô‡πâ‡∏≤ history -->
  <script type="module" src="history.js" defer></script>

  <style>
    :root{
      --bg:#f8fafc;
      --card: rgba(255,255,255,.72);
      --card2: rgba(255,255,255,.96);
      --text:#0f172a;
      --muted:#64748b;
      --border: rgba(226,232,240,.95);

      --blue:#38bdf8;
      --violet:#8b5cf6;

      --ok:#22c55e;
      --late:#f59e0b;
      --absent:#ef4444;

      --shadow: 0 18px 55px rgba(2,6,23,.10);
      --shadow2: 0 26px 70px rgba(2,6,23,.14);
      --r: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      min-height:100vh;
      font-family:"Kanit","Inter",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 560px at 12% 14%, rgba(56,189,248,.16), transparent 62%),
        radial-gradient(900px 560px at 88% 16%, rgba(139,92,246,.14), transparent 62%),
        radial-gradient(900px 560px at 50% 92%, rgba(34,197,94,.10), transparent 62%),
        linear-gradient(180deg,#fff,var(--bg));
    }

    /* ===== Scrollbar (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤) ===== */
    html{ overflow-y: scroll; scrollbar-gutter: stable; }
    ::-webkit-scrollbar{ width: 14px; }
    ::-webkit-scrollbar-track{
      background: rgba(2,6,23,.06);
      border-left: 1px solid rgba(226,232,240,.9);
    }
    ::-webkit-scrollbar-thumb{
      background: linear-gradient(180deg, rgba(56,189,248,.90), rgba(139,92,246,.80));
      border-radius: 999px;
      border: 3px solid rgba(255,255,255,.90);
    }
    ::-webkit-scrollbar-thumb:hover{
      background: linear-gradient(180deg, rgba(56,189,248,1), rgba(139,92,246,.95));
    }
    *{ scrollbar-width: auto; scrollbar-color: rgba(139,92,246,.80) rgba(2,6,23,.06); }

    /* ===== Topbar (Sticky + Balanced) ===== */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 10000; /* ‚úÖ ‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏±‡∏ö */
      width:100%;
      height: 66px;
      border-bottom: 1px solid var(--border);
      background: rgba(255,255,255,.86);
      backdrop-filter: blur(12px);

      /* ‚úÖ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
      will-change: transform;
      transform: translateZ(0);
    }

    .topbar-inner{
      max-width:1100px;
      margin:0 auto;
      height:100%;
      padding: 0 18px;

      /* ‚úÖ ‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏Å‡∏ß‡πà‡∏≤ flex */
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      gap: 12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 0;
    }
    .logo{
      width:36px;height:36px;border-radius:14px;
      background: linear-gradient(135deg, var(--blue), var(--violet));
      box-shadow: 0 12px 26px rgba(2,6,23,.10);
      flex:0 0 auto;
    }
    .btext{
      min-width:0;
      line-height:1.05;
    }
    .btitle{
      font-weight:1000;
      letter-spacing:-.2px;
      font-size:.98rem;
      white-space:nowrap;

      /* ‚úÖ ‡∏Å‡∏±‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤‡∏ß‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏° */
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .bsub{
      margin-top:6px;
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: .86rem;
      font-weight:900;
    }
    .tag{
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(2,6,23,.03);
      color: rgba(15,23,42,.82);
      font-weight:1000;
      font-size: .78rem;
      white-space:nowrap;
      box-shadow: 0 10px 22px rgba(2,6,23,.05);
    }

    .actions{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      justify-self:end;
    }

    .btn{
      border:none;
      cursor:pointer;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight:1000;
      font-size:.82rem;
      color:#04121f;
      background: linear-gradient(90deg, var(--blue), #60a5fa);
      box-shadow: 0 16px 40px rgba(56,189,248,.18);
      display:inline-flex;
      align-items:center;
      gap:8px;
      text-decoration:none;
      user-select:none;
      white-space:nowrap;
      transition:.18s;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 22px 58px rgba(56,189,248,.22); }

    .btn.secondary{
      background: transparent;
      border: 1px solid var(--border);
      box-shadow:none;
      color: var(--text);
    }
    .btn.secondary:hover{
      transform: translateY(-1px);
      border-color: rgba(148,163,184,.70);
      box-shadow: 0 16px 40px rgba(2,6,23,.10);
    }

    .btn.danger{
      background: linear-gradient(135deg, rgba(239,68,68,.95), rgba(245,158,11,.95));
      color:#fff;
      box-shadow: 0 16px 40px rgba(239,68,68,.18);
    }

    /* ===== Main ===== */
    .wrap{
      max-width: 1100px;
      margin: 0 auto;
      padding: 22px 18px 56px; /* ‚úÖ ‡∏´‡∏≤‡∏¢‡∏ä‡∏¥‡∏î‡∏´‡∏±‡∏ß‡πÄ‡∏ß‡πá‡∏ö + ‡∏î‡∏π‡∏ö‡∏≤‡∏•‡∏≤‡∏ô‡∏ã‡πå‡∏Ç‡∏∂‡πâ‡∏ô */
    }

    #historyMsg{
      margin: 6px 0 14px;
      font-size: .95rem;
      text-align:center;
      color: var(--muted);
      font-weight: 1000;
      min-height: 20px;
    }

    .card{
      border-radius: var(--r);
      background: var(--card2);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card-head{
      padding: 16px 18px 12px;
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      border-bottom: 1px solid rgba(226,232,240,.85);
      background: rgba(255,255,255,.70);
      backdrop-filter: blur(10px);
    }
    .card-head h3{
      margin:0;
      font-size:1.05rem;
      font-weight:1000;
      letter-spacing:-.2px;
    }
    .hint{
      margin-top:6px;
      color: var(--muted);
      font-weight:900;
      font-size: .9rem;
    }

    /* ===== Toolbar (‡πÑ‡∏°‡πà‡∏£‡∏Å) ===== */
    .toolbar{
      margin: 14px 18px 16px;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(226,232,240,.95);
      background: rgba(2,6,23,.02);
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content: space-between;
      box-shadow: 0 12px 30px rgba(2,6,23,.06);
    }
    .group{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }

    .filter-btn{
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(226,232,240,.95);
      background: rgba(255,255,255,.90);
      color: var(--text);
      font-size: .82rem;
      font-weight: 1000;
      cursor:pointer;
      transition:.18s;
      display:inline-flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 10px 22px rgba(2,6,23,.05);
      white-space:nowrap;
    }
    .filter-btn:hover{ transform: translateY(-1px); border-color: rgba(148,163,184,.70); }
    .filter-btn.active{
      background: linear-gradient(90deg, var(--blue), #60a5fa);
      border-color: transparent;
      color:#04121f;
      box-shadow: 0 18px 45px rgba(56,189,248,.20);
    }

    .badge{
      font-size:.74rem;
      padding:2px 8px;
      border-radius:999px;
      background: rgba(2,6,23,.04);
      border: 1px solid rgba(226,232,240,.95);
      color: rgba(15,23,42,.72);
      font-weight: 1000;
    }

    .search{
      width: min(420px, 80vw);
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid rgba(226,232,240,.95);
      background: rgba(255,255,255,.92);
      box-shadow: 0 10px 22px rgba(2,6,23,.05);
    }
    .search input{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color: var(--text);
      font-size: .9rem;
      font-weight: 900;
    }
    .search input::placeholder{ color: rgba(100,116,139,.70); font-weight:900; }

    .export-btn{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(226,232,240,.95);
      background: rgba(2,6,23,.03);
      color: var(--text);
      font-size: .82rem;
      font-weight: 1000;
      cursor:pointer;
      transition:.18s;
      box-shadow: 0 10px 22px rgba(2,6,23,.05);
      white-space:nowrap;
    }
    .export-btn:hover{
      transform: translateY(-1px);
      border-color: rgba(148,163,184,.70);
      box-shadow: 0 18px 45px rgba(2,6,23,.10);
    }

    /* ===== Table ===== */
    .table-wrap{ padding: 0 18px 18px; }
    table{
      width:100%;
      border-collapse: collapse;
      border-radius: 16px;
      overflow:hidden;
      border: 1px solid rgba(226,232,240,.95);
      background: rgba(255,255,255,.96);
      box-shadow: 0 12px 30px rgba(2,6,23,.06);
    }
    thead th{
      text-align:left;
      font-size:.82rem;
      color: rgba(100,116,139,.95);
      padding: 12px;
      background: rgba(2,6,23,.02);
      border-bottom: 1px solid rgba(226,232,240,.95);
      font-weight: 1000;
      letter-spacing:.7px;
      white-space:nowrap;
    }
    tbody td{
      padding: 12px;
      border-bottom: 1px solid rgba(226,232,240,.75);
      font-size: .92rem;
      color: var(--text);
      font-weight: 800;
      white-space:nowrap;
    }
    tbody tr:hover td{ background: rgba(56,189,248,.06); }
    tbody tr:last-child td{ border-bottom:none; }

    .time-col{ font-variant-numeric: tabular-nums; font-weight: 1000; letter-spacing:.2px; }
    .status-ok{ color: var(--ok); font-weight: 1000; }
    .status-late{ color: var(--late); font-weight: 1000; }
    .status-absent{ color: var(--absent); font-weight: 1000; }

    .empty{
      text-align:center;
      padding: 18px 12px;
      color: var(--muted);
      font-weight: 1000;
      white-space: normal;
    }

    @media (max-width: 768px){
      .topbar{ height:auto; }
      .topbar-inner{
        padding: 10px 14px;
        grid-template-columns: 1fr; /* ‚úÖ ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á‡πÉ‡∏´‡πâ‡πÇ‡∏•‡πà‡∏á */
        gap: 10px;
      }
      .actions{ justify-self:start; }
      .wrap{ padding: 18px 14px 46px; }
      .card-head{ padding: 14px 14px 10px; }
      .toolbar{ margin: 12px 14px 14px; }
      .table-wrap{ padding: 0 14px 14px; }
      .bsub{ display:none; } /* ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏¢‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡πÇ‡∏•‡πà‡∏á */
    }
  </style>
</head>

<body>
  <!-- ‚úÖ Sticky Topbar -->
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo"></div>
        <div class="btext">
          <div class="btitle">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
          <div class="bsub">
            <span id="studentNameDisplay">-</span>
            <span class="tag">üÜî <span id="studentIdDisplay">-</span></span>
          </div>
        </div>
      </div>

      <div class="actions">
        <a class="btn secondary" href="dashboard.html">üìä Dashboard</a>
        <a class="btn secondary" href="scan.html">üì∏ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</a>
        <button class="btn danger" type="button" onclick="logoutStudent()">üö™ ‡∏≠‡∏≠‡∏Å</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="historyMsg"></div>

    <section class="card">
      <div class="card-head">
        <div>
          <h3>üßæ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
          <div class="hint">‡πÄ‡∏ß‡∏•‡∏≤ / ‡∏ß‡∏¥‡∏ä‡∏≤ / ‡∏´‡πâ‡∏≠‡∏á / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ / ‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</div>
        </div>
        <div class="hint">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ATTENDANCE</div>
      </div>

      <!-- ‚úÖ Toolbar (‡∏Ñ‡∏á id/data-* ‡πÉ‡∏´‡πâ history.js) -->
      <div class="toolbar">
        <div class="group" aria-label="date-filter">
          <button class="filter-btn active" data-date="ALL">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
          <button class="filter-btn" data-date="TODAY">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
          <button class="filter-btn" data-date="WEEK">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</button>
        </div>

        <div class="group" aria-label="status-filter">
          <button class="filter-btn active" data-status="ALL">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span class="badge" id="countAll">0</span></button>
          <button class="filter-btn" data-status="OK">OK <span class="badge" id="countOK">0</span></button>
          <button class="filter-btn" data-status="LATE">LATE <span class="badge" id="countLATE">0</span></button>
          <button class="filter-btn" data-status="ABSENT">ABSENT <span class="badge" id="countABSENT">0</span></button>
        </div>

        <div class="group" aria-label="search-export">
          <div class="search">
            üîé
            <input id="searchInput" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏ß‡∏¥‡∏ä‡∏≤ / ‡∏Ñ‡∏£‡∏π..." autocomplete="off" />
          </div>
          <button class="export-btn" id="btnExportCSV" type="button">‚¨áÔ∏è CSV</button>
          <button class="export-btn" id="btnExportXLSX" type="button">‚¨áÔ∏è Excel</button>
        </div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤</th>
              <th>üìö ‡∏ß‡∏¥‡∏ä‡∏≤</th>
              <th>üè´ ‡∏´‡πâ‡∏≠‡∏á</th>
              <th>‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              <th>üë©‚Äçüè´ ‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô</th>
            </tr>
          </thead>
          <tbody id="historyBody">
            <tr><td colspan="5" class="empty">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    function logoutStudent(){
      try{
        localStorage.removeItem("cpvc_student");
        localStorage.removeItem("studentSession");
        sessionStorage.clear();
      }catch(e){}
      window.location.href = "login.html";
    }
  </script>
</body>
</html>
