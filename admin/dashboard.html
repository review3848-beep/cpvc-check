<!doctype html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<title>Admin Dashboard | NexAttend</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#020617;
  --panel:#0f172a;
  --border:rgba(148,163,184,.18);
  --text:#e5e7eb;
  --muted:#94a3b8;
  --accent:#38bdf8;
  --success:#34d399;
  --danger:#f87171;
}

/* ===== RESET / FIT ===== */
*{box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:linear-gradient(180deg,#020617,#020617);
  color:var(--text);
}

/* ===== HEADER (‡πÄ‡∏ï‡∏µ‡πâ‡∏¢) ===== */
.header{
  height:56px;
  padding:.6rem 1.2rem;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid var(--border);
  background:linear-gradient(180deg,#0f172a,#020617);
}
.header h1{margin:0;font-size:1.25rem}
.meta{font-size:.75rem;color:var(--muted)}
.status{
  margin-left:.5rem;
  padding:.15rem .5rem;
  border-radius:999px;
  font-size:.6rem;
  background:rgba(52,211,153,.18);
  color:var(--success);
}

/* ===== CONTAINER ===== */
.container{
  height:calc(100vh - 56px);
  padding:1rem 1.2rem;
}

/* ===== KPI (‡πÄ‡∏ï‡∏µ‡πâ‡∏¢) ===== */
.kpis{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:.8rem;
}
.kpi{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:1rem;
  padding:.8rem 1rem;
}
.kpi .label{font-size:.7rem;color:var(--muted)}
.kpi .value{font-size:1.4rem;font-weight:700}
.kpi.danger .value{color:var(--danger)}
.kpi.success .value{color:var(--success)}

/* ===== MAIN GRID ===== */
.grid{
  height:calc(100% - 104px); /* KPI ‡∏™‡∏π‡∏á‡∏£‡∏ß‡∏° */
  margin-top:.8rem;
  display:grid;
  grid-template-columns:2.2fr 1fr;
  gap:.8rem;
}

/* ===== ACTIONS ===== */
.actions{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:.8rem;
}
.action{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:1rem;
  padding:.9rem 1rem;
  position:relative;
  cursor:pointer;
}
.action.primary{border-color:var(--accent)}
.action h3{margin:.1rem 0 .2rem;font-size:.95rem}
.action p{margin:0;font-size:.72rem;color:var(--muted)}
.badge{
  position:absolute;
  top:8px;right:8px;
  font-size:.6rem;
  padding:.2rem .45rem;
  border-radius:999px;
  background:rgba(248,113,113,.18);
  color:var(--danger);
}

/* ===== CHART (‡∏•‡πá‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á) ===== */
.chart-box{
  margin-top:.8rem;
  height:160px;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:1rem;
  padding:.6rem .8rem;
}
.chart-box h3{margin:.2rem 0 .4rem;font-size:.9rem}
.chart-box canvas{height:100px !important}

/* ===== ACTIVITY (‡πÑ‡∏°‡πà‡∏î‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤) ===== */
.panel{
  height:100%;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:1rem;
  padding:.8rem;
  display:flex;
  flex-direction:column;
}
.panel h3{margin:0 0 .4rem;font-size:.95rem}
.timeline{
  list-style:none;
  margin:0;
  padding:0;
  overflow:hidden;
}
.timeline li{
  padding:.4rem 0;
  font-size:.75rem;
  border-bottom:1px dashed var(--border);
}
.timeline span{display:block;font-size:.6rem;color:var(--muted)}

/* ===== MOBILE ===== */
@media(max-width:900px){
  html,body{overflow:auto}
  .container{height:auto}
  .kpis{grid-template-columns:repeat(2,1fr)}
  .grid{height:auto;grid-template-columns:1fr}
  .actions{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="header">
  <h1>Admin Dashboard</h1>
  <div class="meta">
    <span id="today"></span>
    <span class="status">‚óè Online</span>
  </div>
</div>

<div class="container">

  <!-- KPI -->
  <div class="kpis">
    <div class="kpi">
      <div class="label">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      <div class="value" id="stat-students">‚Äî</div>
    </div>
    <div class="kpi">
      <div class="label">‡∏Ñ‡∏£‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      <div class="value" id="stat-teachers">‚Äî</div>
    </div>
    <div class="kpi danger">
      <div class="label">‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
      <div class="value" id="stat-absent">‚Äî</div>
    </div>
    <div class="kpi success">
      <div class="label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
      <div class="value" id="stat-rate">0%</div>
    </div>
  </div>

  <div class="grid">

    <!-- LEFT -->
    <div>
      <div class="actions">
        <div class="action primary" data-target="users.html">
          <span class="badge" id="badge-users">0</span>
          <h3>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
          <p>‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
        </div>
        <div class="action" data-target="review.html">
          <span class="badge" id="badge-review">0</span>
          <h3>üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
          <p>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</p>
        </div>
        <div class="action" data-target="settings.html">
          <h3>‚öô ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
          <p>Late / Auto-Absent</p>
        </div>
      </div>

      <div class="chart-box">
        <h3>üìä ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 7 ‡∏ß‡∏±‡∏ô</h3>
        <canvas id="trendChart"></canvas>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="panel">
      <h3>üìå Activity ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
      <ul class="timeline" id="activityList">
        <li class="muted">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‚Ä¶</li>
      </ul>
    </div>

  </div>

</div>

<script type="module">
import { callApi } from "../js/api.js";

/* DATE */
document.getElementById("today").textContent =
  new Date().toLocaleDateString("th-TH",{dateStyle:"medium"});

/* STATS */
async function loadStats(){
  try{
    const d = await callApi("adminStats");
    document.getElementById("stat-students").textContent = d.students ?? "‚Äî";
    document.getElementById("stat-teachers").textContent = d.teachers ?? "‚Äî";
    document.getElementById("stat-absent").textContent = d.absent ?? "‚Äî";
    const rate = Number.isFinite(d.rate) ? d.rate : 0;
    document.getElementById("stat-rate").textContent = rate + "%";
  }catch(e){}
}

/* BADGES */
async function loadBadges(){
  try{
    const d = await callApi("adminBadges");
    setBadge("badge-users", d.users);
    setBadge("badge-review", d.review);
  }catch(e){}
}
function setBadge(id,val){
  const el=document.getElementById(id);
  if(!el) return;
  const n=Number(val||0);
  el.style.display = n>0?"inline-block":"none";
  el.textContent = n;
}

/* ACTIVITY */
async function loadActivity(){
  const list=document.getElementById("activityList");
  try{
    const data=await callApi("adminActivity");
    list.innerHTML="";
    (data||[]).slice(0,4).forEach(a=>{
      const li=document.createElement("li");
      li.innerHTML=`${a.text}<span>${a.time}</span>`;
      list.appendChild(li);
    });
    if(!list.children.length){
      list.innerHTML='<li class="muted">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ activity ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</li>';
    }
  }catch(e){
    list.innerHTML='<li class="muted">‡πÇ‡∏´‡∏•‡∏î activity ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</li>';
  }
}

/* CHART */
let chart;
async function loadChart(){
  try{
    const d=await callApi("adminTrend7Days");
    if(!d?.values?.length) return;
    if(chart) chart.destroy();
    chart=new Chart(document.getElementById("trendChart"),{
      type:"line",
      data:{labels:d.labels,datasets:[{data:d.values,borderColor:"#38bdf8",tension:.4,pointRadius:0}]},
      options:{plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}
    });
  }catch(e){}
}

/* ROUTE */
document.querySelectorAll("[data-target]").forEach(el=>{
  el.onclick=()=>location.href=el.dataset.target;
});

/* INIT */
loadStats(); loadBadges(); loadActivity(); loadChart();
</script>
<!-- ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ SUPER ADMIN -->
<div class="action" data-role="super" data-target="users.html">
  <h3>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h3>
</div>

<!-- ADMIN + SUPER -->
<div class="action" data-role="admin" data-target="notifications.html">
  <h3>üîî Notification</h3>
</div>

</body>
</html>
